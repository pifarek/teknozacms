

function imageUploader(editor, album_id){
    $('#image-uploader').fadeIn(200);
    $('#image-uploader select[name="image-uploader-album"]').val(album_id);
    $.getJSON(settings.base_url + '/administrator/json/file-upload', {album_id: album_id}, function(response){
        if(response.status === 'ok'){
            $('#image-uploader .inner .images').html(response.html);
            // Add image into Tinymce
            $('#image-uploader .tinymce-add-image').unbind('click');
            $('#image-uploader .tinymce-add-image').click(function(){
                var image_src = $(this).attr('data-image');
                var image_html = '<img src="' + image_src + '" alt="">';
                editor.execCommand('mceInsertContent', false, image_html);
                imageUploaderClose();
                return false;
            });
            
            // Select album
            $('#image-uploader select[name="image-uploader-album"]').unbind('change');
            $('#image-uploader select[name="image-uploader-album"]').change(function(){
                var album_id = $(this).val();
                
                imageUploader(editor, album_id);
            });
            
            $('#image-uploader .close').click(function(){
                imageUploaderClose();
                return false;
            });
            
            // Upload image - uploader
            $('#image-uploader .image-uploader-upload').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    if(data.result.status === 'ok'){
                        var album_id = $('select[name="image-uploader-album"]').val();
                        $('#image-uploader .image-uploader-upload').attr('disabled', false);
                        imageUploader(editor, album_id);
                    }
                },
                add: function (e, data) {
                    var album_id = $('select[name="image-uploader-album"]').val();
                    if(album_id <= 0){
                        bootbox.alert('You need to select album first.');
                    }else{
                        $('#image-uploader .image-uploader-upload').attr('disabled', true);
                        data.submit();
                    }
                }
             });
        } 
    });
}

function imageUploaderClose(){
    $('#image-uploader').fadeOut(200, function(){
        $('#image-uploader .inner .images').html('');
    });
}

// Common functions
$(document).ready(function(){
   
   // ImageFill
   $('.imagefill').imagefill();
   
    // Active all tabs
    $('.nav-tabs').not('.not-active').each(function(){
        $(this).children('li:first').children('a').trigger('click');
    });
    
    // Tinymce
    tinymce.init({
        mode: "textareas",
        theme : "modern",
        toolbar1: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | forecolor backcolor | link image mybutton | fontsizeselect | fontselect ',
        selector: "textarea.tinymce",
        plugins: "link image table fullscreen code textcolor code",
        language: settings.language,
        relative_urls: false,
        setup : function(ed) {
            // Add a custom button
            ed.addButton('mybutton', {
                title : 'Upload Image',
                icon : 'template',
                onclick : function() {
                    imageUploader(ed, 0);
                }
            });
        }
    });
    
    // Active select
    $('.selectpicker').selectpicker();
    
    // Active datetimepicker
    $('.datepicker').datetimepicker({
        format: 'DD-MM-YYYY'
    });

    $('.datetimepicker').datetimepicker({
        format: 'DD-MM-YYYY HH:mm'
    });
   
   // Fancybox
   $(".fancybox").fancybox({
    helpers: {
      overlay: {
        locked: false
      }
    }
  });

    // Popover
    $('[data-toggle="popover2"]').popover({'trigger': 'hover'});
    
    // Multiple Languages
    $('.languages-available input[type="checkbox"]').change(function(){
        var locale_id = $(this).val();
        var number_of_locales = $('.languages-available input[type="checkbox"]').length;
        var selected_locales = [];
        // Get selected locales
        $('.languages-available input[type="checkbox"]:checked').each(function(){
            selected_locales.push($(this).val());
        });
        // Show tabs if at least one locale is selected
        if(selected_locales.length > 0){
            $('.languages-selector .nav-tabs').removeClass('hidden');
            $('.languages-selector .tab-content').removeClass('hidden');
            
            $('.languages-selector .nav-tabs li').addClass('hidden');
            $('.languages-selector .tab-content .tab-pane').addClass('hidden');
            
            for(i in selected_locales){
                //alert(selected_locales[i]);
                $('.languages-selector .nav-tabs li[data-locale="' + selected_locales[i] + '"]').removeClass('hidden');
                $('.languages-selector .tab-content .tab-pane[data-locale="' + selected_locales[i] + '"]').removeClass('hidden');
            }
            
            // Active first visible locale
            $('.languages-selector .nav-tabs li:visible:first a').trigger('click');
            
        }else{
            $('.languages-selector .nav-tabs').addClass('hidden');
            $('.languages-selector .tab-content').addClass('hidden');
        }

    });

    $('.languages-available input[type="checkbox"]:checked').each(function(){
       $(this).trigger('change');
    });

    // Make first visible locale active
    $('.languages-selector .nav-tabs li:visible:first a').trigger('click');
$('.languages-selector .nav-tabs li:visible:first a').css('background: red');
});